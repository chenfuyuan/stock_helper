## Context

当前项目中 API 响应格式存在不一致性：
- `data_engineering` 模块已正确使用 `BaseResponse[T]` 格式
- `coordinator` 模块使用自定义的 `ResearchOrchestrationResponse` 模型
- `llm_platform` 模块使用自定义的 `WebSearchApiResponse` 模型
- `knowledge_center` 模块直接返回列表或自定义模型
- 其他模块也存在类似的不一致情况

这种不一致导致前端处理复杂化，错误处理不统一，违反了项目的技术规范要求。

## Goals / Non-Goals

**Goals:**
- 统一所有 REST API 接口使用 `BaseResponse[T]` 响应格式
- 标准化错误处理，确保所有异常都通过统一的错误格式返回
- 保持现有业务逻辑不变，仅修改响应包装格式
- 更新相关的类型注解和 API 文档

**Non-Goals:**
- 不修改业务逻辑或数据处理流程
- 不改变接口的请求参数或路径
- 不新增额外的依赖或框架
- 不涉及数据库结构变更

## Decisions

### 1. 响应模型重构策略
**决策**: 保留现有的自定义响应模型，将它们作为 `BaseResponse[T]` 的泛型参数，而不是完全删除。

**理由**: 
- 最小化变更影响，避免破坏现有代码
- 保持业务数据的结构化表示
- 便于后续维护和扩展

**替代方案考虑**:
- 完全删除自定义模型，直接返回原始数据 - 会导致类型安全性降低
- 创建新的包装模型 - 增加不必要的复杂性

### 2. 错误处理统一化
**决策**: 利用现有的 `ErrorResponse` 类，在异常处理中间件中统一包装错误响应。

**理由**:
- 项目已有完善的 `ErrorResponse` 定义
- 避免在每个路由中重复错误处理逻辑
- 确保错误响应格式的一致性

### 3. 分模块实施策略
**决策**: 按模块顺序逐步实施，优先处理使用频率高的核心模块。

**实施顺序**:
1. `coordinator` - 研究编排核心接口
2. `llm_platform` - 搜索和聊天接口
3. `knowledge_center` - 图谱查询接口
4. `research`、`debate`、`judge` - 分析模块
5. `foundation`、`market_insight` - 支撑模块

**理由**: 
- 降低实施风险，便于问题定位
- 核心模块优先，确保主要功能稳定
- 便于分阶段测试和验证

## Risks / Trade-offs

### [Risk] 破坏现有接口兼容性
**描述**: 响应格式变更可能影响现有的调用方
**缓解措施**: 
- 用户明确说明所有接口都没有被前端使用
- 可以进行破坏性变更
- 建议添加版本标记或文档说明

### [Risk] 类型注解更新工作量较大
**描述**: 需要更新大量的 `response_model` 注解
**缓解措施**:
- 使用批量查找替换工具
- 分模块进行，确保每个模块完整更新
- 利用 IDE 的类型检查功能验证

### [Trade-off] 响应数据嵌套层级增加
**描述**: 数据会被包装在 `BaseResponse.data` 字段中，增加一层嵌套
**缓解措施**:
- 这是统一响应格式的必要代价
- 前端可以通过解构赋值简化访问
- 长期来看，统一格式带来的便利大于嵌套成本

## Migration Plan

### 实施步骤
1. **准备阶段**
   - 备份当前代码
   - 确认测试环境可用

2. **分模块实施**
   - 按既定顺序逐个模块修改
   - 每个模块完成后进行单元测试
   - 验证响应格式正确性

3. **集成测试**
   - 所有模块修改完成后进行集成测试
   - 验证跨模块调用是否正常
   - 检查错误处理是否统一

4. **文档更新**
   - 更新 API 文档
   - 更新开发规范文档

### 回滚策略
- 保留原始代码的 Git 提交记录
- 如遇问题可快速回滚到修改前的状态
- 分模块实施降低了整体回滚的需要

## Open Questions

1. 是否需要在 `BaseResponse` 中添加额外的元数据字段（如请求ID、时间戳等）？
2. 对于流式响应接口，如何统一处理响应格式？
3. 是否需要为不同的错误类型定义标准的错误码体系？
