# 盘后复盘增强方案：数据策略

## 1. 目标 (Objective)

为了满足超短线交易的盘后复盘需求，需要在现有 `market_insight` 模块的基础上，扩充关键的市场情绪、资金行为和事件驱动等数据维度，从而提供更深度的市场洞察，为次日交易提供决策支持。

## 2. 现状分析 (Current State)

当前 `market_insight` 模块已具备以下核心能力：
- **概念热度计算**：基于日线行情，计算各概念板块的整体表现。
- **涨停扫描归因**：识别当日涨停股票，并将其归因至相关概念。
- **生成每日报告**：将以上分析结果输出为 Markdown 格式的日报。

这些功能提供了市场的基本表象，但缺少对市场情绪和主力资金行为的深度解读。

## 3. 缺失的关键数据维度 (Key Missing Data Dimensions)

为了从“现象描述”升级为“深度洞察”，我们需要补充以下关键数据：

| 数据类别 | 具体指标 | 解决的关键问题 |
| :--- | :--- | :--- |
| **市场情绪量化** | 连板梯队统计与市场最高连板高度 | 评估市场风险偏好和情绪顶点 |
| | 昨日涨停股的次日表现 | 判断赚钱/亏钱效应，评估追涨风险 |
| | 炸板率及炸板股分析 | 衡量市场分歧度和资金封板意愿 |
| **主力资金行为** | 龙虎榜数据分析（机构、游资席位） | 追踪“聪明钱”和“热钱”的动向 |
| | 主要板块/个股的资金净流入估算 | 判断主力资金的进攻方向 |
| **关键事件驱动** | 异动股票/概念的新闻关联 | 理解股价异动的背后驱动因素 |

## 4. 数据获取策略 (Data Acquisition Strategy)

考虑到 Tushare 2000 积分的限制以及对数据质量的要求，我们采用**“Tushare + AkShare”**的混合策略，以实现成本、质量和数据广度的最佳平衡。

### 4.1. 策略核心

- **Tushare (作为基石数据源)**: 用于获取对准确性要求最高的**基础日线行情数据**。我们信任其数据的准确性和稳定性。
- **AkShare (作为增强数据源)**: 用于免费获取 Tushare 中需要高积分或未提供的，但对复盘至关重要的**情绪指标和市场行为数据**。

### 4.2. 数据源分工详情

| 数据项 | 推荐获取方式 | 目标工具/接口 | 理由 |
| :--- | :--- | :--- | :--- |
| **基础日线行情** | **Tushare API** | `daily` 接口 | 数据质量高，准确可靠，作为所有计算的基石。 |
| **连板梯队统计** | **AkShare** | `ak.stock_zt_pool_em` | 直接返回连板天数，无需本地计算，方便快捷。 |
| **昨日涨停表现** | **AkShare** | `ak.stock_zt_pool_previous_em` | 直接返回统计结果，功能精准。 |
| **炸板率统计** | **AkShare** | `ak.stock_zt_pool_zbgc_em` | 专门的“炸板股池”接口，满足需求。 |
| **龙虎榜详情** | **AkShare** | `ak.stock_lhb_detail_em` | 完美替代高积分接口，数据源为东方财富，行业公认。 |
| **资金流向** | **AkShare** | `ak.stock_individual_fund_flow` | 免费获取个股资金流数据。 |
| **新闻快讯** | **AkShare** | `ak.stock_news_em` 等 | 免费获取多来源新闻，用于本地进行事件关联。 |

## 5. 建议架构 (Proposed Architecture)

此混合策略的数据流架构如下：

```
          ┌──────────────────────────┐
          │   Tushare (2000 积分)    │
          │ (提供高精度基础数据)     │
          └────────────┬─────────────┘
                       │ (日线行情等)
           ┌───────────▼───────────┐
           │                       │
           │      您的复盘系统       │
           │                       │
           └───────────▲───────────┘
                       │ (情绪/资金数据)
          ┌────────────┴─────────────┐
          │      AkShare (免费)      │
          │ (提供丰富的情绪/行为数据)  │
          └──────────────────────────┘
```

## 6. 下一步 (Next Steps)

1.  **环境准备**: 在项目中安装 `akshare` 库。
2.  **适配器开发**:
    *   为上述 AkShare 提供的各项数据，开发新的数据端口（Port）和适配器（Adapter）。
    *   遵循现有的六边形架构，将数据获取逻辑封装在 `infrastructure` 层。
3.  **领域服务与应用层更新**:
    *   开发新的领域服务来处理和分析这些新数据。
    *   更新 `GenerateDailyReportCmd` 应用服务，将新的分析结果整合到每日复盘报告中。

通过此方案，可以在极低的成本下，极大地丰富复盘系统的数据维度和分析深度。
